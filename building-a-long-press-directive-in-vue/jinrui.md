# 用Vue编写一个长按指令

![Alt text](https://raw.githubusercontent.com/OFED/translation/master/building-a-long-press-directive-in-vue/img/1_0neT5mha2f00A3CXxA8r6w.png)

你有没有想过只需按住一个按钮几秒钟就能在你的Vue应用程序中执行一个功能？

你有没有想过在你的应用程序里创建一个按钮，通过按一次来清除单个输入(或者按住一个按钮清除所有输入)？

你想过？很好，我也是。你来对地方了。

本文将教你如何通过按下(或按住)按钮来执行一个功能或移除输入。

首先，我将解释如何在 VanillaJS 中实现这一点。然后，为它创建一个Vue指令。

系好安全带。我可能要让你大吃一惊。

## 理论

要实现长按，用户需要按住按钮几秒钟。

要通过代码实现这一功能，我们需要在鼠标“点击”按钮时启动一个计时器来监听按钮被按下的时间，不管用户按住按钮多长时间，当设定的时间到了以后执行功能。

非常简单！然而，我们需要知道用户何时按住该按钮。

## 如何实现

当用户点击按钮时，在点击事件之前会触发另外两个事件: `mousedown` 和 `mouseup`。

当用户按下鼠标按钮时调用 `mousedown` 事件，而当用户释放该按钮时调用 `mouseup` 事件。

我们需要做的是:

1. 触发mousedown事件时，启动计时器。
1. 一旦 `mouseup` 事件在预先设置的 2 秒前被触发，就清除计时器，不要执行该功能。即这只是一个点击事件。

只要计时器在到达我们设定的时间之前没有被清除，即 `mouseup` 事件没有被触发——我们可以说用户没有释放按钮。因此，这被认为是一个长按事件，然后我们可以继续执行所述功能。

## 实践

让我们深入研究一下代码，并完成它。

首先，我们必须定义三件事，即:

1. 一个 **变量** 用于存储计时器。
1. 一个 **启动** 功能函数，用于启动计时器。
1. 一个 **取消** 功能函数，用于取消计时器。

### 变量

这个变量主要用来保存 `setTimeout` 的值，以便当鼠标 `mouseup` 事件触发时我们可以取消它。

```js
let pressTimer = null;
```

我们把变量值设置为 `null` 是为了在执行取消操作前，我们可以检查这个变量的值以了解当前是否有一个正在运行的计时器。

### 启动函数
